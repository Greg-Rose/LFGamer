<div class="row show-game">
  <div class="col-sm-6 col-md-4 col-md-offset-1 col-lg-3 col-lg-offset-1 text-center">
    <%= image_tag(@game.cover_image.url, class: "show-cover-image") %>
  </div>
  <div class="col-sm-6 col-md-4 col-md-offset-1 col-lg-4 col-lg-offset-1">
    <h2 class="text-center"><%= @game.name %></h2>
    <br>
    <p class="text-center">
      <% @game.consoles.reorder(:id).each do |c| %>
        <%= c.name %>
        <%= "/" if @game.consoles.reorder(:id).last != c %>
      <% end %>
    </p>
    <p class="text-center">
      <%= "Online" if @game.online %>
      <%= "/" if @game.online && @game.split_screen %>
      <%= "Split Screen" if @game.split_screen %>
    </p>
  </div>
  <% if current_user %>
    <div class="col-sm-10 col-sm-offset-1 col-md-8 col-md-offset-2 col-lg-8 col-lg-offset-2 ownerships-form-div">
      <div class="well text-center">
        <% if @user.has_game?(@game) %>
          <h4>Update My Games</h4>
        <% else %>
          <h4>Add To My Games</h4>
        <% end %>

        <%= form_tag(ownerships_path, method: "post") do %>
          <%= hidden_field(:game, :id) %>
          <div class="form-group">
            <%= collection_check_boxes(:user, :games_console_ids, @game.games_consoles.reorder(:console_id), :id, :console_name) do |c| %>
              <%= c.label(class: "checkbox-inline") { c.check_box + c.text } %>
            <% end %>
          </div>
          <div class="form-group">
            <% if @user.has_game?(@game) %>
              <%= submit_tag "Update My Games", class: "btn btn-success" %>
            <% else %>
              <%= submit_tag "Add To My Games", class: "btn btn-success" %>
            <% end %>
          </div>
        <% end %>
      </div>
    </div>

    <% if current_user.has_game?(@game) %>
      <div class="col-sm-10 col-sm-offset-1 col-md-8 col-md-offset-2 col-lg-8 col-lg-offset-2 lfg-form">
        <div class="panel panel-default">
          <div class="panel-body">
            <h4 class="text-center">Create LFG</h4>

            <%= form_for @lfg, url: lfgs_path do |f| %>
              <%= form_error_messages!(@lfg) %>
              <%= hidden_field(:game, :id) %>
              <div class="form-group col-sm-4">
                <%= f.label :ownership_id, "Console" %>
                <%= f.collection_select(:ownership_id, @game.ownerships.where(user: @user), :id, :console_name, {}, {class: "form-control"}) %>
              </div>

              <div class="form-group col-sm-6 col-sm-offset-2">
                <h5>Show PSN ID/Xbox Gamertag?</h5>
                <div class="checkbox">
                  <%= f.label(:show_console_username) do %>
                    <%= f.check_box(:show_console_username) %> Yes
                  <% end %>
                </div>
              </div>

              <div class="form-group col-sm-12">
                <%= f.label :specifics %>
                <%= f.text_field :specifics, placeholder: "Details about what you want to play, how many people are needed, etc.", class: "form-control" %>
              </div>

              <div class="form-groupc col-sm-6 col-sm-offset-3 text-center">
                <%= f.submit "Look For Group", class: "btn btn-success btn-block" %>
              </div>
            <% end %>
          </div>
        </div>
      </div>
    <% end %>

    <% if @lfg.persisted? %>
      <div class="col-sm-12 game-lfgs-list">
        <div class="panel panel-default">
          <div class="panel-body">
            <h4 class="text-center">LFGs</h4>

            <table class="table table-striped table-bordered">
              <tr>
                <th class="text-center">
                  <div>
                    LFG Username
                  </div>
                  <div>
                    Console -
                    <% if @lfg.console.name.include?("PlayStation") %>
                      PSN ID
                    <% elsif @lfg.console.name.include?("Xbox") %>
                      Xbox Gamertag
                    <% end %>
                  </div>
                </th>
                <th class="text-center">Specifics</th>
                <th class="text-center">When</th>
                <th class="text-center">
                  <div>Request To</div>
                  <div>Play Together</div>
                </th>
              </tr>
              <% @game.lfgs.order(created_at: :desc).each do |lfg| %>
                <% if lfg.console == @lfg.console %>
                  <tr class="text-center">
                    <td>
                      <div>
                        <%= link_to lfg.user.username, profile_path(lfg.user.profile) %>
                      </div>
                      <div>
                        <%= lfg.console.abbreviation || lfg.console.name %> <%= show_console_username_if_chosen(lfg) %>
                      </div>
                    <td>
                      <div>
                        <%= lfg.specifics %>
                      </div>
                    </td>
                    <td>
                      <div>
                        <%= time_ago_in_words(lfg.created_at) %> ago
                      </div>
                    </td>
                    <td><%= button_to "Request", "#", class: "btn btn-primary" %></td>
                  </tr>
                <% end %>
              <% end %>
            </table>
          </div>
        </div>
      </div>
    <% end %>
  <% end %>
</div>
